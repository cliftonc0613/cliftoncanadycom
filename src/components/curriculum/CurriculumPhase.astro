---
// CurriculumPhase.astro
// Expandable phase section (Foundation, Portfolio Projects, Career Launch)
// Wraps weeks in details/summary
// Mobile-first: closed by default; Desktop (1024px+): open by default

import CurriculumWeek from "./CurriculumWeek.astro";

interface Session {
  session: number;
  title: string;
  description: string;
  badge: "hands-on" | "project-based" | "career-coaching";
}

interface Week {
  week: number;
  title: string;
  sessions: Session[];
}

interface Props {
  phase: string;
  weeks: Week[];
}

const { phase, weeks } = Astro.props;

// Format phase name for display
const phaseDisplay = phase.toUpperCase();
const phaseRanges: Record<string, string> = {
  "Foundation": "WEEKS 1-4",
  "Portfolio Projects": "WEEKS 5-7",
  "Career Launch": "WEEK 8"
};
const weekRange = phaseRanges[phase] || phaseDisplay;
---

<details class="curriculum-phase group border-2 border-gray-200 rounded-lg px-2 py-3 md:p-6 cursor-pointer transition-all">
  <summary
    class="flex items-center justify-between cursor-pointer font-bold text-lg text-primary hover:text-primary/80 transition-colors select-none"
    aria-expanded="false"
  >
    <span>{weekRange}: {phase}</span>
    <span class="text-2xl transition duration-300 group-open:rotate-180">â€º</span>
  </summary>

  <div class="mt-4 md:mt-6 space-y-3 md:space-y-4">
    {weeks.map((week) => (
      <CurriculumWeek
        week={week.week}
        title={week.title}
        sessions={week.sessions}
      />
    ))}
  </div>
</details>

<style>
  .curriculum-phase {
    transition: background-color 0.3s ease, border-color 0.3s ease;
  }

  .curriculum-phase summary {
    transition: color 0.3s ease;
  }

  .curriculum-phase summary::-webkit-details-marker {
    display: none;
  }

  .curriculum-phase[open] {
    background-color: rgb(239, 246, 255); /* bg-blue-50 */
    border-color: var(--primary, #1E40AF);
  }

  .curriculum-phase[open] summary {
    color: var(--primary, #1E40AF);
  }

  /* Mobile-first: closed by default */
  @media (max-width: 1023px) {
    .curriculum-phase {
      /* Closed by default on mobile */
    }
  }

  /* Desktop (1024px+): open by default */
  @media (min-width: 1024px) {
    .curriculum-phase {
      background-color: rgb(239, 246, 255); /* bg-blue-50 */
      border-color: var(--primary, #1E40AF);
    }

    .curriculum-phase summary {
      color: var(--primary, #1E40AF);
    }
  }
</style>

<script>
  // Update aria-expanded attribute when details element opens/closes
  document.querySelectorAll('.curriculum-phase').forEach((el) => {
    const details = el as HTMLDetailsElement;
    const summary = details.querySelector('summary');

    details.addEventListener('toggle', () => {
      summary?.setAttribute('aria-expanded', details.open ? 'true' : 'false');
    });

    // Set initial aria-expanded state
    summary?.setAttribute('aria-expanded', details.open ? 'true' : 'false');
  });
</script>
