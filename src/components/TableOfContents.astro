---
interface Props {
  content: string;
}

const { content } = Astro.props;

// Extract H2 and H3 headings from the markdown content
// This regex looks for markdown heading syntax (## and ###)
const headingRegex = /^(#{2,3})\s+(.+)$/gm;
const headings: Array<{ level: number; text: string; id: string }> = [];

let match;
while ((match = headingRegex.exec(content)) !== null) {
  const level = match[1].length; // 2 for ##, 3 for ###
  const text = match[2].trim();
  // Convert heading text to URL-friendly ID (lowercase, replace spaces with hyphens)
  const id = text
    .toLowerCase()
    .replace(/[^\w\s-]/g, '')
    .replace(/\s+/g, '-')
    .replace(/-+/g, '-');

  headings.push({ level, text, id });
}

// Only show TOC if there are headings
const hasTOC = headings.length > 0;
---

{hasTOC && (
  <nav class="bg-slate-900 rounded-lg p-4 md:p-6 my-6 md:my-8 border border-slate-700 shadow-lg">
    <h3 class="text-base md:text-lg font-bold font-[Poppins] text-white mb-4">
      Table Of Contents
    </h3>
    <ul class="space-y-2">
      {headings.map((heading, index) => {
        const h2Count = headings.filter((h, i) => i < index && h.level === 2).length;
        const numberPrefix = heading.level === 2 ? `${h2Count + 1}. ` : '';

        return (
          <li class={heading.level === 3 ? 'ml-6' : ''}>
            <a
              href={`#${heading.id}`}
              class={`text-sm transition-colors font-[Roboto_Mono] ${
                heading.level === 2
                  ? 'text-blue-300 hover:text-blue-100 font-semibold'
                  : 'text-slate-300 hover:text-slate-100'
              }`}
            >
              {numberPrefix}{heading.text}
            </a>
          </li>
        );
      })}
    </ul>
  </nav>
)}

<style>
  /* Smooth scroll behavior for TOC links */
  :global(html) {
    scroll-behavior: smooth;
  }

  /* Hide scrollbar for modern browsers while keeping functionality */
  div::-webkit-scrollbar {
    width: 6px;
  }

  div::-webkit-scrollbar-track {
    background: transparent;
  }

  div::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 3px;
  }

  div::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
  }
</style>
